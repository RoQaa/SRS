(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[489],{76223:function(e,r,t){Promise.resolve().then(t.bind(t,90647))},73215:function(e,r,t){"use strict";var a=t(2265),n=t(40718),s=t.n(n),i=t(36760),l=t.n(i),c=t(28137),o=["className","cssModule","innerRef","tag"];function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var u={className:s().string,cssModule:s().object,innerRef:s().oneOfType([s().object,s().string,s().func]),tag:c.iC};function p(e){var r=e.className,t=e.cssModule,n=e.innerRef,s=e.tag,i=function(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}(e,o),u=(0,c.mx)(l()(r,"card-body"),t);return a.createElement(void 0===s?"div":s,d({},i,{className:u,ref:n}))}p.propTypes=u,r.Z=p},99914:function(e,r,t){"use strict";var a=t(2265),n=t(40718),s=t.n(n),i=t(36760),l=t.n(i),c=t(28137),o=["className","cssModule","fluid","tag"];function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var u={tag:c.iC,fluid:s().oneOfType([s().bool,s().string]),className:s().string,cssModule:s().object};function p(e){var r=e.className,t=e.cssModule,n=e.fluid,s=e.tag,i=function(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}(e,o),u="container";!0===n?u="container-fluid":n&&(u="container-".concat(n));var p=(0,c.mx)(l()(r,u),t);return a.createElement(void 0===s?"div":s,d({},i,{className:p}))}p.propTypes=u,r.Z=p},41221:function(e,r,t){"use strict";var a=t(2265),n=t(40718),s=t.n(n),i=t(36760),l=t.n(i),c=t(28137),o=["className","cssModule","type","size","color","children","tag"];function d(){return(d=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var u={tag:c.iC,type:s().oneOf(["border","grow"]),size:s().oneOf(["sm"]),color:s().oneOf(["primary","secondary","success","danger","warning","info","light","dark"]),className:s().string,cssModule:s().object,children:s().string};function p(e){var r=e.className,t=e.cssModule,n=e.type,s=void 0===n?"border":n,i=e.size,u=e.color,p=e.children,m=void 0===p?"Loading...":p,f=e.tag,h=function(e,r){if(null==e)return{};var t,a,n=function(e,r){if(null==e)return{};var t,a,n={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],r.indexOf(t)>=0||(n[t]=e[t]);return n}(e,r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(n[t]=e[t])}return n}(e,o),g=(0,c.mx)(l()(r,!!i&&"spinner-".concat(s,"-").concat(i),"spinner-".concat(s),!!u&&"text-".concat(u)),t);return a.createElement(void 0===f?"div":f,d({role:"status"},h,{className:g}),m&&a.createElement("span",{className:(0,c.mx)("visually-hidden",t)},m))}p.propTypes=u,r.Z=p},79205:function(e,r,t){"use strict";var a=t(57437);t(2265),r.Z=e=>{let{iconId:r,className:t,style:n}=e;return(0,a.jsx)("svg",{className:t,style:n,children:(0,a.jsx)("use",{href:"/assets/svg/icon-sprite.svg#".concat(r)})})}},90647:function(e,r,t){"use strict";t.d(r,{default:function(){return D}});var a=t(57437),n=t(2265),s=t(99914),i=t(50288),l=t(98723),c=t(65051),o=t(73215),d=t(77314),u=t(99376),p=t(43207),m=t(82097);let f=e=>{let{lang:r="en"}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(i.Z,{children:(0,a.jsx)(l.Z,{children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(m.Z,{check:!0,children:"en"===r?"Name":"Name (Arabic)"}),(0,a.jsx)(d.gN,{name:"en"===r?"name":"name_ar",type:"text",className:"form-control",placeholder:"Product Name"}),"en"===r?(0,a.jsx)(d.Bc,{name:"name",component:"span",className:"text-danger"}):(0,a.jsx)(d.Bc,{name:"name_ar",component:"span",className:"text-danger"})]})})})})};var h=t(45394),g=t(50984),v=t(41221);let x=()=>{let e=(0,h.T)(),{productsData:r,loading:t}=(0,h.C)(e=>e.products),{currentProduct:s}=(0,h.C)(e=>e.products);(0,n.useEffect)(()=>{(async()=>{r.length||await e((0,g.t2)())})()},[e,r]);let c=s?r.filter(e=>e._id!==s._id):r;return(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(l.Z,{sm:"6",children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(m.Z,{check:!0,children:"Category"}),t?(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)(v.Z,{size:"sm",color:"primary"})}):(0,a.jsxs)(d.gN,{as:"select",name:"parentProductId",className:"form-control form-select",children:[(0,a.jsx)("option",{value:"",children:"Select Category"}),c.length>0&&c.map(e=>{var r;return(0,a.jsx)("option",{value:null==e?void 0:null===(r=e._id)||void 0===r?void 0:r.toString(),children:e.name.toUpperCase()},e._id)})]}),(0,a.jsx)(d.Bc,{name:"parentProductId",component:"span",className:"text-danger"})]})}),(0,a.jsx)(l.Z,{sm:"6",children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(m.Z,{children:"Publish"}),(0,a.jsxs)(d.gN,{name:"published",as:"select",className:"form-control form-select",children:[(0,a.jsx)("option",{value:"true",children:"Publish"}),(0,a.jsx)("option",{value:"false",children:"Un Publish"})]})]})})]})};var y=t(71008);let j=e=>{let{lang:r="en"}=e;return(0,a.jsx)(i.Z,{children:(0,a.jsx)(l.Z,{children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(m.Z,{check:!0,children:"en"===r?y.mz3:y.mz3+" (Arabic)"}),(0,a.jsx)(d.gN,{name:"en"===r?"description":"description_ar",as:"textarea",className:"form-control",rows:3}),(0,a.jsx)(d.Bc,{name:"en"===r?"description":"description_ar",component:"span",className:"text-danger"})]})})})};var b=t(42586),N=t(27648),w=t(80201);let P=()=>{let e=(0,b.useLocale)();return(0,a.jsx)(i.Z,{children:(0,a.jsx)(l.Z,{children:(0,a.jsxs)("div",{className:"text-end",children:[(0,a.jsx)(w.Z,{type:"submit",color:"success",className:"me-3",children:"Update"}),(0,a.jsx)(N.default,{className:"btn btn-danger",href:"".concat("https://stagingsrv.gazala.net","/").concat(e,"/dashboard/products"),children:"Cancel"})]})})})};var O=t(94926),Z=t(79205),_=t(180),F=t(48055),A=e=>{let{setFieldValue:r,oldImages:t}=e,[s,i]=(0,n.useState)([]),l=e=>{i(e),r("images",e.filter(e=>e.valid).map(e=>e.file))},c=e=>{let t=s.filter(r=>r.id!==e);i(t),r("images",t.filter(e=>e.valid).map(e=>e.file))};return(0,n.useEffect)(()=>{(async()=>{t&&Array.isArray(t)&&i((await Promise.all(t.map(async e=>{try{let r=await (0,_.f)("".concat("https://stagingsrv.gazala.net/api","/").concat(e),(0,F.w)("".concat("https://stagingsrv.gazala.net/api","/").concat(e)));return{id:r.name,name:r.name,size:r.size,type:r.type,valid:!0,file:r,preview:!0}}catch(e){return console.error("Failed to convert image URL to file:",e),null}}))).filter(e=>null!==e))})()},[t]),(0,a.jsxs)("div",{className:"product-upload mt-2",children:[(0,a.jsxs)("p",{children:["Product Gallery",(0,a.jsx)("span",{className:"txt-danger",children:" *"})]}),(0,a.jsxs)(O.fh,{onChange:e=>l(e),value:s,maxFiles:5,header:!1,footer:!1,minHeight:"80px",name:"images",children:[s.map(e=>(0,a.jsx)(O.Q$,{...e,onDelete:()=>c(e.id),info:!0,preview:!0},e.id)),0===s.length&&(0,a.jsxs)("div",{className:"dz-message needsclick",children:[(0,a.jsx)(Z.Z,{iconId:"file-upload1"}),(0,a.jsx)("h5",{children:"Drag Images here"}),(0,a.jsx)("span",{className:"note needsclick",children:"Add Product Gallery Images"})]})]}),(0,a.jsx)(d.Bc,{name:"images",component:"span",className:"text-danger"})]})},z=t(18206);let C=["image/jpeg","image/png","image/gif","image/webp"];var I=e=>{let{setFieldValue:r,oldThumbnail:t,oldImages:s}=e,[i,l]=(0,n.useState)([]),[c,o]=(0,n.useState)(null),u=e=>{if(e.file){if(!C.includes(e.file.type))return z.Am.error("Invalid file type. Allowed types are PNG, JPEG, GIF, and WebP."),!1;if(e.file.size>5242880)return z.Am.error("File size exceeds 2 MB limit."),!1}return!0},p=e=>{e.file instanceof File?(o(e),r("thumbnail",e.file)):console.error("Invalid file provided for thumbnail.")};return(0,n.useEffect)(()=>{(async()=>{if(t)try{let e=(0,F.w)("".concat("https://stagingsrv.gazala.net/api","/").concat(t)),r=await (0,_.f)("".concat("https://stagingsrv.gazala.net/api","/").concat(t),e);if(r instanceof File){let e={id:r.name,file:r,name:r.name,size:r.size,type:r.type,preview:!0};o(e)}else console.error("Thumbnail is not a valid file.")}catch(e){console.error("Failed to load thumbnail:",e)}})()},[t]),(0,a.jsx)("div",{className:"sidebar-body mt-4",children:(0,a.jsxs)("div",{className:"product-upload",children:[(0,a.jsxs)("p",{children:["Product Thumbnail",(0,a.jsx)("span",{className:"txt-danger",children:" *"})]}),(0,a.jsxs)(O.fh,{onChange:e=>{let r=e.filter(u);r.length>0&&p(r[0])},value:c?[c]:[],maxFiles:1,header:!1,footer:!1,minHeight:"80px",name:"thumbnail",children:[c&&(0,a.jsx)(O.Q$,{...c,onDelete:()=>{o(null),r("thumbnail",null)},info:!0,preview:!0},c.id),0===i.length&&!c&&(0,a.jsxs)("div",{className:"dz-message needsclick",children:[(0,a.jsx)(Z.Z,{iconId:"file-upload"}),(0,a.jsxs)("h5",{children:["Drag your image here, or",(0,a.jsx)(N.default,{className:"txt-primary",href:y.zOc,children:"\xa0browse"})]}),(0,a.jsx)("span",{className:"note needsclick",children:"SVG, PNG, JPG or GIF"})]})]}),(0,a.jsx)(d.Bc,{name:"thumbnail",component:"span",className:"text-danger"}),(0,a.jsx)("br",{}),(0,a.jsx)(A,{setFieldValue:r,oldImages:null!=s?s:[]})]})})},E=t(34422),k=e=>{let{slug:r}=e,t=(0,u.useRouter)(),s=(0,h.T)(),i=(0,b.useLocale)(),{formValues:c,loading:o}=(0,h.C)(e=>e.products),[p,m]=(0,n.useState)(!1);if((0,n.useEffect)(()=>{(async()=>{await s((0,g.dQ)(r)),m(!0)})()},[s,r]),o&&!p)return(0,a.jsxs)(l.Z,{sm:"12",className:"text-center",children:[(0,a.jsx)(v.Z,{color:"primary"}),(0,a.jsx)("p",{children:"Loading..."})]});let y=async e=>{let a=new FormData;Object.keys(e).forEach(r=>{"thumbnail"!==r&&"images"!==r&&void 0!==e[r]&&null!==e[r]&&a.append(r,String(e[r]))}),Array.isArray(e.images)&&e.images.forEach(e=>{a.append("images",e)}),e.thumbnail&&a.append("thumbnail",e.thumbnail);try{(await s((0,g.nM)({formData:a,slug:r})).unwrap()).status&&(z.Am.success("Product updated successfully!"),t.push("/".concat(i,"/dashboard/products/")))}catch(e){e instanceof Error?(z.Am.error((null==e?void 0:e.message)||"Error updating product."),console.error("Error updating product:",e)):z.Am.error("Error updating product.")}};return(0,a.jsx)(d.J9,{initialValues:c||{name:"",name_ar:"",description:"",description_ar:"",parentProductId:null,published:!1,thumbnail:null,images:[]},validationSchema:S,onSubmit:y,children:e=>{var r,t;let{setFieldValue:n}=e;return(0,a.jsxs)(d.l0,{className:"theme-form",children:[(0,a.jsx)(f,{lang:"en"}),(0,a.jsx)(j,{lang:"en"}),(0,a.jsx)(x,{}),(0,a.jsx)(I,{setFieldValue:n,oldThumbnail:(null==c?void 0:null===(r=c.thumbnail)||void 0===r?void 0:r.length)>0?null==c?void 0:c.thumbnail:"",oldImages:(null==c?void 0:null===(t=c.images)||void 0===t?void 0:t.length)>0?c.images:[]}),(0,a.jsxs)("h3",{className:"py-2 my-3",children:[(0,a.jsx)("span",{className:"text-danger",children:"*"}),"Add Details In Arabic"]}),(0,a.jsx)(f,{lang:"ar"}),(0,a.jsx)(j,{lang:"ar"}),(0,a.jsx)(P,{})]})}})};let S=E.Ry().shape({name:E.Z_().required("Name is required"),name_ar:E.Z_().required("Arabic name is required"),description:E.Z_().required("Description is required"),description_ar:E.Z_().required("Arabic description is required"),parentProductId:E.Z_().nullable().optional(),published:E.O7().required("Published status is required")});var D=()=>{let e=(0,u.useSearchParams)().get("id");return(0,a.jsx)(s.Z,{fluid:!0,children:(0,a.jsx)(i.Z,{children:(0,a.jsx)(l.Z,{sm:"12",children:(0,a.jsx)(c.Z,{children:(0,a.jsx)(o.Z,{children:(0,a.jsx)(k,{slug:e})})})})})})}},45394:function(e,r,t){"use strict";t.d(r,{C:function(){return s},T:function(){return n}});var a=t(68575);let n=a.I0,s=a.v9},50984:function(e,r,t){"use strict";t.d(r,{Ir:function(){return p},dQ:function(){return o},nM:function(){return u},r7:function(){return y},ry:function(){return d},t2:function(){return c}});var a=t(1455),n=t(83464),s=t(43577),i=t(64131);let l="".concat("https://stagingsrv.gazala.net/api","/edit-website/products"),c=(0,a.hg)("products/fetchProducts",async(e,r)=>{let{rejectWithValue:t}=r;try{let e=await n.default.get(l,{headers:{Authorization:"Bearer ".concat(i.Z.get("auth_token"))}});if(200!==e.status)throw Error("Failed to fetch products. Status: ".concat(e.status));return e.data.data}catch(e){if(e instanceof s.d7){var a;return t((null==e?void 0:null===(a=e.response)||void 0===a?void 0:a.data)||"Failed to fetch products")}}}),o=(0,a.hg)("products/fetchProductBySlug",async(e,r)=>{let{rejectWithValue:t}=r;try{let r=await n.default.get("".concat(l,"/").concat(e),{headers:{Authorization:"Bearer ".concat(i.Z.get("auth_token"))}});if(200!==r.status)return t(r.data.message||"Failed to fetch product.");return r.data.data}catch(e){if(e instanceof s.d7){var a;return t((null==e?void 0:null===(a=e.response)||void 0===a?void 0:a.data)||"An unexpected error occurred.")}}}),d=(0,a.hg)("products/createProduct",async(e,r)=>{let{dispatch:t,rejectWithValue:a}=r;try{let r=await n.default.post(l,e,{headers:{Authorization:"Bearer ".concat(i.Z.get("auth_token"))}});if(201!==r.status)return a(r.data.message||"Failed to create product.");let s=r.data;return t(v(s)),s}catch(e){if(e instanceof s.d7){var c;return a((null==e?void 0:null===(c=e.response)||void 0===c?void 0:c.data)||"An unexpected error occurred.")}}}),u=(0,a.hg)("products/updateProduct",async(e,r)=>{let{formData:t,slug:a}=e,{rejectWithValue:c}=r;try{let e=await n.default.patch("".concat(l,"/").concat(a),t,{headers:{Authorization:"Bearer ".concat(i.Z.get("auth_token"))}});if(200!==e.status)return c(e.data.message||"Failed to update product.");return e.data}catch(e){if(e instanceof s.d7){var o;return c((null==e?void 0:null===(o=e.response)||void 0===o?void 0:o.data)||"An unexpected error occurred.")}}}),p=(0,a.hg)("products/deleteProduct",async(e,r)=>{let{dispatch:t,rejectWithValue:a}=r;try{let r=await n.default.delete("".concat(l,"/").concat(e),{headers:{Authorization:"Bearer ".concat(i.Z.get("auth_token"))}});if(200!==r.status)return a(r.data.message||"Failed to delete product.");return t(x(e)),e}catch(e){if(e instanceof s.d7){var c;return a((null==e?void 0:null===(c=e.response)||void 0===c?void 0:c.data)||"An unexpected error occurred.")}}}),m={productsData:[],currentProduct:null,loading:!1,error:null,activeTab:"1",formValues:{name:"",name_ar:"",description:"",description_ar:"",parentProductId:null,thumbnail:"",images:[],published:!1}},f=(0,a.oM)({name:"products",initialState:m,reducers:{setCurrentProduct:(e,r)=>{e.currentProduct=r.payload},clearCurrentProduct:e=>{e.currentProduct=null},addProduct:(e,r)=>{e.productsData.push(r.payload)},removeProduct:(e,r)=>{e.productsData=e.productsData.filter(e=>e._id!==r.payload)},setActiveTab:(e,r)=>{e.activeTab=r.payload},setFormValues:(e,r)=>{e.formValues=r.payload},clearFormValues:e=>{e.formValues=m.formValues}},extraReducers:e=>{e.addCase(c.pending,e=>{e.loading=!0,e.error=null}).addCase(c.fulfilled,(e,r)=>{e.loading=!1,e.productsData=r.payload}).addCase(c.rejected,(e,r)=>{e.loading=!1,e.error=r.error.message||"Failed to load products data."}).addCase(o.pending,e=>{e.loading=!0,e.error=null}).addCase(o.fulfilled,(e,r)=>{e.loading=!1,e.currentProduct=r.payload,e.formValues={name:r.payload.name,name_ar:r.payload.name_ar,description:r.payload.description,description_ar:r.payload.description_ar,parentProductId:r.payload.parentProductId,thumbnail:r.payload.thumbnail,images:r.payload.images,published:r.payload.published}}).addCase(o.rejected,(e,r)=>{e.loading=!1,e.error=r.error.message||"Failed to fetch product."}).addCase(u.pending,e=>{e.loading=!0,e.error=null}).addCase(u.fulfilled,(e,r)=>{e.loading=!1;let t=e.productsData.findIndex(e=>e._id===r.payload._id);-1!==t&&(e.productsData[t]=r.payload),e.currentProduct=r.payload}).addCase(u.rejected,(e,r)=>{e.loading=!1,e.error=r.error.message||"Failed to update product."})}}),{setCurrentProduct:h,clearCurrentProduct:g,addProduct:v,removeProduct:x,setActiveTab:y,setFormValues:j,clearFormValues:b}=f.actions;r.ZP=f.reducer},180:function(e,r,t){"use strict";t.d(r,{f:function(){return a}});let a=async(e,r)=>{if(e instanceof File)return e;if(!e||"string"!=typeof e)throw Error("Invalid URL provided: "+e);try{let t=await fetch(e);if(!t.ok){if(404===t.status)return console.warn("File not found at URL: ".concat(e)),new File([],r);throw Error("Failed to fetch image from URL: ".concat(e))}let a=await t.blob();return new File([a],r,{type:a.type})}catch(e){return console.error("Error converting URL to file:",e),new File([],r)}}},48055:function(e,r,t){"use strict";t.d(r,{w:function(){return a}});let a=e=>{try{return new URL(e).pathname.split("/").pop()||"default_filename.png"}catch(r){return console.error("Invalid URL provided:",e),"default_filename.png"}}},43577:function(e,r,t){"use strict";t.d(r,{d7:function(){return n}});let{Axios:a,AxiosError:n,CanceledError:s,isCancel:i,CancelToken:l,VERSION:c,all:o,Cancel:d,isAxiosError:u,spread:p,toFormData:m,AxiosHeaders:f,HttpStatusCode:h,formToJSON:g,getAdapter:v,mergeConfig:x}=t(83464).default}},function(e){e.O(0,[2292,2586,3464,7648,3537,8206,6474,4520,1008,2971,2117,1744],function(){return e(e.s=76223)}),_N_E=e.O()}]);